
<h2><%= @project.name %></h2>
<div class="field">
  <%= label_tag 'Name' %>
  <%= @project.name %>
</div>
<div class="field">
  <%= label_tag 'Description' %>
  <%= @project.description %>
</div>


<%= link_to 'Back', projects_path, :class => 'button' %>
<br/>
<br/>

<div id="release-list">
  <%= render 'releases/list' %>
</div>

<%= link_to 'New Release', 'javascript:newRelease()', :class => 'button' %>

<div id="new-release-form" class="hidden">

 <%= render :partial => 'releases/form',
            :locals => {
              :@project => @project,
              :@release => @project.releases.new,
            } %>
</div>

<div id="edit-release-form" class="hidden">
</div>

<script>
  function newRelease()
  {
    $('#new-release-form').dialog({
      resizable: false,
      title: 'New Release',
      height: 'auto',
      width: 'auto',
      modal: true,
      buttons: {
        'Cancel': function() {
          $(this).dialog('close');
        },
        'Save': function() {
          createRelease();
          $(this).dialog('close');
        }
      },
      close: function() {
        $(this).dialog('destroy');
      }
    });
  }

  function createRelease()
  {
    $.loading('Creating Release');
    var form = $('#new-release-form > form');

    $.ajax({
      url: form.attr('action'),
      type: 'POST',
      dataType: 'text',
      data: form.serialize(),
      complete: function(xhr) {
        eval(xhr.responseText);
        form[0].reset();
        $.finished('Release successfully created');
      }
    });
  }
  
  function findRelease(urlPath)
  {
    $.loading('Retrieving Release');

    $.ajax({
      url: urlPath,
      type: 'GET',
      dataType: 'text',
      complete: function(xhr) {
        eval(xhr.responseText);
        $('#dloading').dialog('destroy');
        editRelease();
      }
    });
  }
  
  function editRelease()
  {
    $('#edit-release-form').dialog({
      resizable: false,
      title: 'Edit Release',
      height: 'auto',
      width: 'auto',
      modal: true,
      buttons: {
        'Cancel': function() {
          $(this).dialog('close');
        },
        'Save': function() {
          updateRelease();
          $(this).dialog('close');
        }
      },
      close: function() {
        $(this).dialog('destroy');
      }
    });
  }
  
  function updateRelease()
  {
    $.loading('Updating Release');
    var form = $('#edit-release-form > form');

    $.ajax({
      url: form.attr('action'),
      type: 'POST',
      dataType: 'text',
      data: form.serialize() + '&method=put',
      complete: function(xhr) {
        eval(xhr.responseText);
        $.finished('Release successfully updated');
      }
    });
  }
  
  function deleteRelease(urlPath)
  {
    $.loading('Destroying Release');
     $.ajax({
      url: urlPath,
      type: 'POST',
      data: '_method=DELETE',
      dataType: 'text',
      complete: function(xhr) {
        eval(xhr.responseText);
        $.finished('Release Destroyed');
      }
    });
  }

</script>
