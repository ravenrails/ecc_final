<%= render 'navigation' %>
<h1>Editing Project</h1>

<div class="tabs">
  <ul>
    <li><a class="" href="#info" id="tab-info">Information</a></li>
    <li><a class="selected" href="#members" id="tab-members">Members</a></li>
  </ul>
</div>

<div class="tab-div" id="info" style="display:none;">
  <%= form_for(@project, :url => admin_project_path(@project)) do |form| %>
    <%= render :partial => 'form', :locals => { :f => form, :project => @project } %>

    <div class="actions">
      <%= form.submit 'Update' %>
      <%= link_to 'Show', admin_project_path(@project), :class => 'button' %>
      <%= link_to 'Cancel', admin_projects_path, :class => 'button' %>
    </div>
  <% end %>
</div>

<div class="tab-div" id="members">
  <%= render 'members' %>
</div>

<script>
  $('.tabs > ul > li > a').click(function() {
    $('.tabs > ul > li > a').removeClass('selected');
    $(this).addClass('selected');

    $('.tab-div').fadeOut();
    $($(this).attr('href')).fadeIn();
  });

  $('#member_submit').click(function() {
      $.ajax({
          url: '<%= admin_project_add_member_path(@project) %>',
          type: 'POST',
          data: $('#member_form').serialize(),
          dataType: 'html',
          complete: function(xhr) {
            $('#members').html(xhr.resposeText)
          }
      });
  });

  updateUrl = '<%= admin_project_update_member_path @project.id %>';
  removeUrl = '<%= admin_project_remove_member_path @project.id %>';

  function show(member_id)
  {
    $('#form-' + member_id).fadeIn();
  }

  function hide(member_id)
  {
    $('#form-' + member_id).fadeOut();
  }

  function removeMember(id)
  {
    $.loading('Removing member');

    $.ajax({
      url: removeUrl.replace('<%= @project.id %>', id),
      type: 'POST',
      data: '_method=DELETE',
      dataType: 'js',
      complete: function(xhr) {
        $('#roles-' + memberId).html(xhr.responseText);
        $.finished('Record Deleted');
      }
    });
  }

  $('[id$="_submit"]').click(function() {
    $.loading('Updating member');
    memberId = $(this).attr('id').replace(/\D/g, '');

    $.ajax({
      url: updateUrl.replace('<%= @project.id %>', memberId),
      type: 'post',
      data: $('#form-' + memberId).serialize() + '&_method=put',
      dataType: 'text',
      complete: function(xhr) {
        $('#roles-' + memberId).html(xhr.responseText);
        $.finished('Member updated.')
      }
    })
  })

</script>
